<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Password Generator</title>
  <style>
    :root{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#0f172a,#001219);color:#e6eef8}
    .card{width:min(760px,96%);background:rgba(255,255,255,0.03);border-radius:12px;padding:22px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}
    h1{margin:0 0 8px 0;font-size:20px}
    p.sub{margin:0 0 18px 0;opacity:0.8}
    .row{display:flex;gap:12px;align-items:center}
    label{font-size:13px}
    input[type=range]{flex:1}
    .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px}
    .options{display:flex;gap:10px;flex-wrap:wrap}
    .output{display:flex;gap:8px;margin:12px 0}
    .output input{flex:1;padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.04);color:inherit;font-weight:600}
    button{background:#0ea5a4;border:0;padding:10px 14px;border-radius:8px;color:#022;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}
    .meter{height:10px;background:rgba(255,255,255,0.07);border-radius:8px;overflow:hidden}
    .meter > i{display:block;height:100%;width:0;background:linear-gradient(90deg,#22c55e,#eab308)}
    footer{margin-top:14px;font-size:13px;opacity:0.8}
    @media(max-width:520px){.controls{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="card">
    <h1>Password Generator</h1>
    <p class="sub">Secure, client-side password generator. Uses crypto.getRandomValues (no data leaves your browser).</p>

    <div class="controls">
      <div>
        <label for="length">Length: <strong id="lenLabel">16</strong></label>
        <div class="row" style="margin-top:8px">
          <input id="length" type="range" min="4" max="128" value="16" />
        </div>
      </div>
      <div>
        <label>Character sets</label>
        <div class="options" style="margin-top:8px">
          <label><input type="checkbox" id="lower" checked /> lower</label>
          <label><input type="checkbox" id="upper" checked /> UPPER</label>
          <label><input type="checkbox" id="numbers" checked /> 0-9</label>
          <label><input type="checkbox" id="symbols" /> !@#$%</label>
          <label><input type="checkbox" id="noAmbig" /> no ambig (O,0,l,1)
          </label>
        </div>
      </div>

      <div>
        <label>Options</label>
        <div class="options" style="margin-top:8px">
          <label><input type="checkbox" id="copyOnGen" checked /> copy on generate</label>
          <label><input type="checkbox" id="pronounceable" /> pronounceable-ish</label>
        </div>
      </div>

      <div>
        <label>Actions</label>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="genBtn">Generate</button>
          <button class="secondary" id="downloadBtn">Download (.txt)</button>
          <button class="secondary" id="shuffleBtn">Shuffle</button>
        </div>
      </div>
    </div>

    <div class="output">
      <input id="out" readonly value="Press generate" />
      <button id="copyBtn">Copy</button>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <div style="flex:1">
        <div class="meter" aria-hidden="true"><i id="meterFill"></i></div>
      </div>
      <div id="entropyText" style="min-width:120px;text-align:right;font-size:13px">Entropy: â€”</div>
    </div>

    <footer>
      This runs entirely in your browser. For best security, use long unique passwords and a reputable password manager.
    </footer>
  </main>

  <script>
    // Secure RNG helper
    function secureRandomInt(max) {
      // returns integer in [0, max)
      const range = max;
      if (range <= 0) return 0;
      const u32 = new Uint32Array(1);
      const limit = Math.floor(0xffffffff / range) * range;
      while (true) {
        crypto.getRandomValues(u32);
        const r = u32[0];
        if (r < limit) return r % range;
      }
    }

    const sets = {
      lower: 'abcdefghijklmnopqrstuvwxyz',
      upper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
      numbers: '0123456789',
      symbols: "!@#$%^&*()_+-=[]{}|;:',.<>/?`~"
    };

    // UI
    const length = document.getElementById('length');
    const lenLabel = document.getElementById('lenLabel');
    const out = document.getElementById('out');
    const genBtn = document.getElementById('genBtn');
    const copyBtn = document.getElementById('copyBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const shuffleBtn = document.getElementById('shuffleBtn');
    const meter = document.getElementById('meterFill');
    const entropyText = document.getElementById('entropyText');

    length.addEventListener('input', ()=>{lenLabel.textContent = length.value});

    function buildCharset() {
      let cs = '';
      if (document.getElementById('lower').checked) cs += sets.lower;
      if (document.getElementById('upper').checked) cs += sets.upper;
      if (document.getElementById('numbers').checked) cs += sets.numbers;
      if (document.getElementById('symbols').checked) cs += sets.symbols;
      if (document.getElementById('noAmbig').checked) cs = cs.replace(/[O0l1I]/g,'');
      return Array.from(new Set(cs)).join(''); // dedupe
    }

    function estimateEntropy(charsCount, length) {
      if (charsCount <= 1) return 0;
      const bits = Math.log2(charsCount) * length;
      return Math.round(bits);
    }

    function updateMeter(charsCount, len) {
      const bits = estimateEntropy(charsCount, len);
      const pct = Math.min(100, Math.round(bits / 6)); // rough scale: 60 bits -> 100%
      meter.style.width = pct + '%';
      entropyText.textContent = `Entropy: ${bits} bits`;
    }

    function genRandomPassword() {
      const cs = buildCharset();
      const len = parseInt(length.value,10);
      if (!cs) return '';

      if (document.getElementById('pronounceable').checked) {
        // simple pronounceable-ish combo of consonant-vowel pairs
        const vowels = 'aeiou';
        const consonants = cs.replace(/[aeiouAEIOU0123456789!@#$%^&*()_+\-=\[\]{}|;:',.<>/?`~]/g,'');
        if (!consonants) { /* fallback to random */ }
        let pw = '';
        for (let i=0;i<len;i++) {
          if (i%2===0) {
            const set = consonants.length?consonants:cs;
            pw += set[secureRandomInt(set.length)];
          } else {
            pw += vowels[secureRandomInt(vowels.length)];
          }
        }
        return pw;
      }

      let pw = '';
      for (let i=0;i<len;i++) pw += cs[secureRandomInt(cs.length)];
      return pw;
    }

    function shuffleString(s) {
      const arr = s.split('');
      for (let i = arr.length -1; i>0; i--) {
        const j = secureRandomInt(i+1);
        [arr[i],arr[j]] = [arr[j],arr[i]];
      }
      return arr.join('');
    }

    genBtn.addEventListener('click', ()=>{
      const cs = buildCharset();
      const len = parseInt(length.value,10);
      if (!cs) { alert('Pick at least one character set'); return; }
      const pw = genRandomPassword();
      out.value = pw;
      updateMeter(cs.length, len);
      if (document.getElementById('copyOnGen').checked) copyToClipboard();
    });

    copyBtn.addEventListener('click', copyToClipboard);
    function copyToClipboard() {
      const val = out.value;
      if (!val) return;
      navigator.clipboard.writeText(val).then(()=>{
        copyBtn.textContent = 'Copied!';
        setTimeout(()=>copyBtn.textContent='Copy',1200);
      });
    }

    downloadBtn.addEventListener('click', ()=>{
      const a = document.createElement('a');
      const text = out.value || '';
      const blob = new Blob([text], {type:'text/plain'});
      a.href = URL.createObjectURL(blob);
      a.download = 'password.txt';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    shuffleBtn.addEventListener('click', ()=>{
      if (!out.value) return;
      out.value = shuffleString(out.value);
    });

    // initial meter
    updateMeter(buildCharset().length, parseInt(length.value,10));
  </script>
</body>
</html>
